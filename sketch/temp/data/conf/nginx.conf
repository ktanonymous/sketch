# nginxの構成ファイルの基本４要素をモジュールと呼ぶ
# core, event, http, mailがモジュール

# 「ディレクティブ名 パラメータ;」 をまとめてディレクティブと呼ぶ
# 設定項目のこと
worker_processes  1;

# 中括弧を持つディレクティブはブロックディレクティブと呼ぶ
# 中身はコンテキストと呼ぶ

# eventsモジュールは省略不可
events {
    # ワーカープロセスが最大でいくつまでコネクションを処理できるかを指定
    worker_connections  1024;
}


http {
    # mime.types: MIMEタイプと拡張子の間の関係を記述
    # レスポンスの際にはmime.typesの記述に従って 拡張子 -> MIMEタイプ とマッピング
    include       mime.types;

    # 上でマッピングできなかった際にはしたのでマッピング
    default_type  application/octet-stream;

    # sendfile関数とやらがあるらしく、それの利用を許可するかどうかを指定
    # 込み入ってて難しい。。。
    sendfile        on;

    # クライアントの要求を待ってあげる最大時間
    # 65秒間要求がなければ接続を切断する
    keepalive_timeout  65;

    # serverディレクティブはhttpディレクティブ内に記述
    server {
        listen       80; # 80番ポートで待機
        server_name  localhost; # サーバの名前。リクエストのHostと比較される

        # ドキュメントルートを指定。指定された場所がサーバーでの配信対象になる
        root /usr/share/nginx/html;

        include /etc/nginx/default.d/*.conf;

        location /images/ {
            root   /usr/share/nginx/html;
        }

        location /www/ {
            root   /usr/share/nginx/html;
        }

        location / {
            proxy_set_header Host $http_host;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_pass http://127.0.0.1:8000;
        }
            # 40xのテキストフレーズが検出された場合、/40x.htmlを返す
        error_page   400 401 403 404  /40x.html;

        # /40x.htmlでマッチングを行う
        # = は完全一致
        location = /40x.html {
            root   /usr/share/nginx/html/www;
        }

    }
}